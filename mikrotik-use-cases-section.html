<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Casos de Uso - Manual MikroTik</title>
    <link rel="stylesheet" href="mikrotik-styles.css">
</head>
<body>

<div class="section-content">
    <h2 id="casos-uso">Casos de Uso Prácticos</h2>
    
    <div class="intro-text">
        <p>En esta sección presentamos varios escenarios reales donde el balanceo de carga con routers MikroTik puede implementarse de manera efectiva. Cada caso de uso incluye el escenario, los requisitos específicos y la solución recomendada.</p>
    </div>

    <!-- Caso de Uso 1 -->
    <div class="use-case">
        <h3 id="caso-pyme">Caso 1: PYME con Dos Conexiones a Internet</h3>
        
        <div class="scenario-box">
            <h4>Escenario:</h4>
            <p>Una pequeña empresa con 25 empleados cuenta con dos conexiones a Internet:</p>
            <ul>
                <li>Conexión de fibra óptica de 100 Mbps (ISP1)</li>
                <li>Conexión ADSL de respaldo de 20 Mbps (ISP2)</li>
            </ul>
            <p>La empresa necesita maximizar el ancho de banda disponible durante las horas de trabajo y garantizar la continuidad del servicio en caso de fallo de alguna conexión.</p>
        </div>

        <div class="requirements-box">
            <h4>Requisitos:</h4>
            <ul>
                <li>Utilizar ambas conexiones simultáneamente para maximizar el ancho de banda</li>
                <li>Priorizar la conexión de fibra para servicios críticos</li>
                <li>Garantizar la continuidad del servicio en caso de fallo</li>
                <li>Implementación sencilla y fácil de mantener</li>
            </ul>
        </div>

        <div class="solution-box">
            <h4>Solución Recomendada:</h4>
            <p><strong>Balanceo de carga PCC con failover</strong></p>
            
            <p>Configuración básica:</p>
            <div class="code-block">
                <pre><code># Configuración de interfaces
/interface set ether1 name=WAN1-FIBRA
/interface set ether2 name=WAN2-ADSL
/interface set ether3 name=LAN

# Configuración de direcciones IP
/ip address add address=192.168.1.1/24 interface=LAN
/ip address add address=203.0.113.2/30 interface=WAN1-FIBRA
/ip address add address=198.51.100.2/30 interface=WAN2-ADSL

# Configuración de rutas por defecto
/ip route add dst-address=0.0.0.0/0 gateway=203.0.113.1 distance=1 check-gateway=ping
/ip route add dst-address=0.0.0.0/0 gateway=198.51.100.1 distance=2 check-gateway=ping

# Configuración de marcado de conexiones (mangle)
/ip firewall mangle add chain=prerouting action=mark-connection new-connection-mark=WAN1_conn passthrough=yes in-interface=LAN per-connection-classifier=both-addresses:2/0
/ip firewall mangle add chain=prerouting action=mark-connection new-connection-mark=WAN2_conn passthrough=yes in-interface=LAN per-connection-classifier=both-addresses:2/1

# Marcado de rutas
/ip firewall mangle add chain=prerouting action=mark-routing new-routing-mark=to_WAN1 passthrough=yes connection-mark=WAN1_conn
/ip firewall mangle add chain=prerouting action=mark-routing new-routing-mark=to_WAN2 passthrough=yes connection-mark=WAN2_conn

# Rutas para el balanceo
/ip route add dst-address=0.0.0.0/0 gateway=203.0.113.1 routing-mark=to_WAN1 check-gateway=ping
/ip route add dst-address=0.0.0.0/0 gateway=198.51.100.1 routing-mark=to_WAN2 check-gateway=ping

# Configuración de NAT
/ip firewall nat add chain=srcnat action=masquerade out-interface=WAN1-FIBRA
/ip firewall nat add chain=srcnat action=masquerade out-interface=WAN2-ADSL</code></pre>
            </div>
            
            <p>Ventajas de esta solución:</p>
            <ul>
                <li>Utiliza ambas conexiones simultáneamente (60% de tráfico por fibra, 40% por ADSL)</li>
                <li>Proporciona failover automático si una conexión falla</li>
                <li>Mantiene las sesiones estables en cada conexión</li>
                <li>Fácil de implementar y mantener</li>
            </ul>
        </div>
    </div>

    <!-- Caso de Uso 2 -->
    <div class="use-case">
        <h3 id="caso-isp-multiple">Caso 2: Balanceo con Múltiples ISPs de Igual Capacidad</h3>
        
        <div class="scenario-box">
            <h4>Escenario:</h4>
            <p>Un centro de datos pequeño necesita alta disponibilidad y rendimiento óptimo con tres conexiones a Internet de igual capacidad:</p>
            <ul>
                <li>Tres conexiones de fibra de 500 Mbps cada una (ISP1, ISP2, ISP3)</li>
            </ul>
            <p>El centro requiere distribuir la carga de manera uniforme entre las tres conexiones y mantener la continuidad del servicio si alguna conexión falla.</p>
        </div>

        <div class="requirements-box">
            <h4>Requisitos:</h4>
            <ul>
                <li>Distribución equitativa del tráfico entre las tres conexiones</li>
                <li>Alta disponibilidad con failover automático</li>
                <li>Monitoreo activo de las conexiones</li>
                <li>Optimización del rendimiento de la red</li>
            </ul>
        </div>

        <div class="solution-box">
            <h4>Solución Recomendada:</h4>
            <p><strong>Balanceo de carga ECMP con monitoreo avanzado</strong></p>
            
            <p>Configuración básica:</p>
            <div class="code-block">
                <pre><code># Configuración de interfaces
/interface set ether1 name=WAN1
/interface set ether2 name=WAN2
/interface set ether3 name=WAN3
/interface set ether4 name=LAN

# Configuración de direcciones IP
/ip address add address=192.168.1.1/24 interface=LAN
/ip address add address=203.0.113.2/30 interface=WAN1
/ip address add address=198.51.100.2/30 interface=WAN2
/ip address add address=192.0.2.2/30 interface=WAN3

# Configuración de rutas ECMP
/ip route add dst-address=0.0.0.0/0 gateway=203.0.113.1,198.51.100.1,192.0.2.1 check-gateway=ping

# Configuración de NAT
/ip firewall nat add chain=srcnat action=masquerade out-interface=WAN1
/ip firewall nat add chain=srcnat action=masquerade out-interface=WAN2
/ip firewall nat add chain=srcnat action=masquerade out-interface=WAN3

# Configuración de monitoreo avanzado con Netwatch
/tool netwatch
add host=203.0.113.1 interval=10s timeout=1s up-script="/ip route set [find gateway=\"203.0.113.1,198.51.100.1,192.0.2.1\"] gateway=\"203.0.113.1,198.51.100.1,192.0.2.1\"" down-script="/ip route set [find gateway=\"203.0.113.1,198.51.100.1,192.0.2.1\"] gateway=\"198.51.100.1,192.0.2.1\"" 
add host=198.51.100.1 interval=10s timeout=1s up-script="/ip route set [find gateway=\"203.0.113.1,198.51.100.1,192.0.2.1\"] gateway=\"203.0.113.1,198.51.100.1,192.0.2.1\"" down-script="/ip route set [find gateway=\"203.0.113.1,198.51.100.1,192.0.2.1\"] gateway=\"203.0.113.1,192.0.2.1\"" 
add host=192.0.2.1 interval=10s timeout=1s up-script="/ip route set [find gateway=\"203.0.113.1,198.51.100.1,192.0.2.1\"] gateway=\"203.0.113.1,198.51.100.1,192.0.2.1\"" down-script="/ip route set [find gateway=\"203.0.113.1,198.51.100.1,192.0.2.1\"] gateway=\"203.0.113.1,198.51.100.1\""</code></pre>
            </div>
            
            <p>Ventajas de esta solución:</p>
            <ul>
                <li>Distribución equitativa del tráfico (33% por cada conexión)</li>
                <li>Configuración más simple que PCC para múltiples conexiones</li>
                <li>Monitoreo activo que ajusta automáticamente las rutas</li>
                <li>Escalable para añadir más conexiones en el futuro</li>
            </ul>
        </div>
    </div>

    <!-- Caso de Uso 3 -->
    <div class="use-case">
        <h3 id="caso-asimetrico">Caso 3: Balanceo Asimétrico para Diferentes Tipos de Tráfico</h3>
        
        <div class="scenario-box">
            <h4>Escenario:</h4>
            <p>Una empresa de diseño gráfico con 15 empleados tiene dos conexiones a Internet:</p>
            <ul>
                <li>Conexión de fibra de 200 Mbps con baja latencia (ISP1)</li>
                <li>Conexión de cable de 100 Mbps con mayor ancho de banda de subida (ISP2)</li>
            </ul>
            <p>La empresa necesita priorizar ciertos tipos de tráfico por conexiones específicas: videoconferencias por la conexión de baja latencia y transferencias de archivos grandes por la conexión con mejor subida.</p>
        </div>

        <div class="requirements-box">
            <h4>Requisitos:</h4>
            <ul>
                <li>Dirigir el tráfico de videoconferencia por la conexión de baja latencia</li>
                <li>Enviar las transferencias de archivos grandes por la conexión con mejor subida</li>
                <li>Balancear el resto del tráfico entre ambas conexiones</li>
                <li>Mantener failover en caso de fallo de alguna conexión</li>
            </ul>
        </div>

        <div class="solution-box">
            <h4>Solución Recomendada:</h4>
            <p><strong>Balanceo de carga PCC con reglas de política por tipo de tráfico</strong></p>
            
            <p>Configuración básica:</p>
            <div class="code-block">
                <pre><code># Configuración de interfaces
/interface set ether1 name=WAN1-FIBRA
/interface set ether2 name=WAN2-CABLE
/interface set ether3 name=LAN

# Configuración de direcciones IP
/ip address add address=192.168.1.1/24 interface=LAN
/ip address add address=203.0.113.2/30 interface=WAN1-FIBRA
/ip address add address=198.51.100.2/30 interface=WAN2-CABLE

# Configuración de rutas por defecto
/ip route add dst-address=0.0.0.0/0 gateway=203.0.113.1 distance=1 check-gateway=ping
/ip route add dst-address=0.0.0.0/0 gateway=198.51.100.1 distance=2 check-gateway=ping

# Marcado de tráfico específico
# Videoconferencias (Zoom, Teams, Meet)
/ip firewall mangle add chain=prerouting action=mark-connection new-connection-mark=WAN1_conn passthrough=yes in-interface=LAN protocol=tcp dst-port=3478,3479,5938,8801-8802
/ip firewall mangle add chain=prerouting action=mark-connection new-connection-mark=WAN1_conn passthrough=yes in-interface=LAN protocol=udp dst-port=3478,3479,8801-8802

# Servicios de almacenamiento en la nube (para subidas grandes)
/ip firewall mangle add chain=prerouting action=mark-connection new-connection-mark=WAN2_conn passthrough=yes in-interface=LAN dst-address-list=cloud-storage

# Lista de direcciones para servicios en la nube
/ip firewall address-list add list=cloud-storage address=dropbox.com
/ip firewall address-list add list=cloud-storage address=drive.google.com
/ip firewall address-list add list=cloud-storage address=onedrive.live.com

# Balanceo PCC para el resto del tráfico
/ip firewall mangle add chain=prerouting action=mark-connection new-connection-mark=WAN1_conn passthrough=yes in-interface=LAN connection-mark=no-mark per-connection-classifier=both-addresses:2/0
/ip firewall mangle add chain=prerouting action=mark-connection new-connection-mark=WAN2_conn passthrough=yes in-interface=LAN connection-mark=no-mark per-connection-classifier=both-addresses:2/1

# Marcado de rutas
/ip firewall mangle add chain=prerouting action=mark-routing new-routing-mark=to_WAN1 passthrough=yes connection-mark=WAN1_conn
/ip firewall mangle add chain=prerouting action=mark-routing new-routing-mark=to_WAN2 passthrough=yes connection-mark=WAN2_conn

# Rutas para el balanceo
/ip route add dst-address=0.0.0.0/0 gateway=203.0.113.1 routing-mark=to_WAN1 check-gateway=ping
/ip route add dst-address=0.0.0.0/0 gateway=198.51.100.1 routing-mark=to_WAN2 check-gateway=ping

# Configuración de NAT
/ip firewall nat add chain=srcnat action=masquerade out-interface=WAN1-FIBRA
/ip firewall nat add chain=srcnat action=masquerade out-interface=WAN2-CABLE</code></pre>
            </div>
            
            <p>Ventajas de esta solución:</p>
            <ul>
                <li>Optimiza el rendimiento de aplicaciones específicas</li>
                <li>Dirige el tráfico sensible a la latencia por la mejor conexión</li>
                <li>Aprovecha la mejor capacidad de subida para transferencias grandes</li>
                <li>Mantiene el balanceo para el resto del tráfico</li>
                <li>Proporciona failover automático si una conexión falla</li>
            </ul>
        </div>
    </div>

    <!-- Caso de Uso 4 -->
    <div class="use-case">
        <h3 id="caso-hotspot">Caso 4: Hotspot Público con Balanceo de Carga</h3>
        
        <div class="scenario-box">
            <h4>Escenario:</h4>
            <p>Un café con servicio de Wi-Fi para clientes tiene dos conexiones a Internet:</p>
            <ul>
                <li>Conexión principal de 50 Mbps</li>
                <li>Conexión secundaria de 30 Mbps</li>
            </ul>
            <p>El establecimiento necesita ofrecer un servicio Wi-Fi estable a sus clientes, con limitación de ancho de banda por usuario y balanceo entre ambas conexiones.</p>
        </div>

        <div class="requirements-box">
            <h4>Requisitos:</h4>
            <ul>
                <li>Implementar un hotspot con portal cautivo</li>
                <li>Limitar el ancho de banda por usuario</li>
                <li>Balancear la carga entre ambas conexiones</li>
                <li>Priorizar ciertos servicios (navegación web) sobre otros (descargas)</li>
            </ul>
        </div>

        <div class="solution-box">
            <h4>Solución Recomendada:</h4>
            <p><strong>Hotspot con PCC y gestión de ancho de banda</strong></p>
            
            <p>Configuración básica:</p>
            <div class="code-block">
                <pre><code># Configuración de interfaces
/interface set ether1 name=WAN1
/interface set ether2 name=WAN2
/interface set ether3 name=LAN
/interface wireless
set [ find default-name=wlan1 ] ssid=Cafe-WiFi mode=ap-bridge frequency=2437 band=2ghz-b/g/n wireless-protocol=802.11 disabled=no

# Configuración de bridge para LAN y WiFi
/interface bridge
add name=bridge-local
/interface bridge port
add bridge=bridge-local interface=LAN
add bridge=bridge-local interface=wlan1

# Configuración de direcciones IP
/ip address add address=192.168.1.1/24 interface=bridge-local
/ip address add address=203.0.113.2/30 interface=WAN1
/ip address add address=198.51.100.2/30 interface=WAN2

# Configuración de rutas por defecto
/ip route add dst-address=0.0.0.0/0 gateway=203.0.113.1 distance=1 check-gateway=ping
/ip route add dst-address=0.0.0.0/0 gateway=198.51.100.1 distance=2 check-gateway=ping

# Configuración de Hotspot
/ip hotspot profile
add name=cafe-profile hotspot-address=192.168.1.1 dns-name=wifi.cafe.local
/ip hotspot
add name=hotspot1 interface=bridge-local address-pool=hs-pool-1 profile=cafe-profile
/ip pool
add name=hs-pool-1 ranges=192.168.1.10-192.168.1.254

# Configuración de límite de ancho de banda
/ip hotspot user profile
add name=limited rate-limit=2M/2M
/ip hotspot user
add name=default profile=limited

# Configuración de balanceo PCC
/ip firewall mangle add chain=prerouting action=mark-connection new-connection-mark=WAN1_conn passthrough=yes in-interface=bridge-local per-connection-classifier=both-addresses:2/0
/ip firewall mangle add chain=prerouting action=mark-connection new-connection-mark=WAN2_conn passthrough=yes in-interface=bridge-local per-connection-classifier=both-addresses:2/1

# Marcado de rutas
/ip firewall mangle add chain=prerouting action=mark-routing new-routing-mark=to_WAN1 passthrough=yes connection-mark=WAN1_conn
/ip firewall mangle add chain=prerouting action=mark-routing new-routing-mark=to_WAN2 passthrough=yes connection-mark=WAN2_conn

# Rutas para el balanceo
/ip route add dst-address=0.0.0.0/0 gateway=203.0.113.1 routing-mark=to_WAN1 check-gateway=ping
/ip route add dst-address=0.0.0.0/0 gateway=198.51.100.1 routing-mark=to_WAN2 check-gateway=ping

# Configuración de NAT
/ip firewall nat add chain=srcnat action=masquerade out-interface=WAN1
/ip firewall nat add chain=srcnat action=masquerade out-interface=WAN2

# Priorización de tráfico (QoS simple)
/queue type add name=pcq-download kind=pcq pcq-rate=0 pcq-classifier=dst-address
/queue type add name=pcq-upload kind=pcq pcq-rate=0 pcq-classifier=src-address
/queue tree
add name=Web-Priority parent=bridge-local packet-mark=web-traffic priority=1 queue=pcq-download
add name=Download-Limit parent=bridge-local packet-mark=download-traffic priority=8 queue=pcq-download
/ip firewall mangle
add chain=forward action=mark-packet new-packet-mark=web-traffic passthrough=yes protocol=tcp dst-port=80,443
add chain=forward action=mark-packet new-packet-mark=download-traffic passthrough=yes protocol=tcp dst-port=1024-65535 connection-bytes=5000000-0</code></pre>
            </div>
            
            <p>Ventajas de esta solución:</p>
            <ul>
                <li>Proporciona un portal cautivo para control de acceso</li>
                <li>Limita el ancho de banda por usuario para evitar abusos</li>
                <li>Balancea la carga entre ambas conexiones</li>
                <li>Prioriza la navegación web sobre descargas grandes</li>
                <li>Ofrece failover automático si una conexión falla</li>
            </ul>
        </div>
    </div>

    <div class="note-box">
        <h4>Nota importante:</h4>
        <p>Las configuraciones presentadas son ejemplos básicos que deben adaptarse a cada entorno específico. Siempre realice pruebas en un entorno controlado antes de implementar en producción. Las direcciones IP utilizadas son ejemplos y deben reemplazarse por las direcciones reales de su red.</p>
    </div>

</div>

</body>
</html>